(()=>{console.log("üöÄ Clarity X-Ray: LOADED");const e=[/verify your account/gi,/verify your identity/gi,/update your payment/gi,/log in/gi,/login/gi,/sign in/gi,/bank account/gi,/wire transfer/gi,/suspended/gi,/deactivated/gi,/urgent/gi,/immediate action/gi,/click here/gi,/social media/gi,/facebook/gi,/password/gi,/credential/gi,/security alert/gi,/unauthorized/gi];setInterval(function(){const n=function(){let e=null,n="No Subject",t="";const o=document.querySelector(".a3s.aiL")||document.querySelector(".a3s"),i=document.querySelector("h2.hP"),r=document.querySelector('[aria-label="Message body"]'),c=document.querySelector(".conv-title"),a=document.querySelector(".message-body, .msg-body, article");if(o)e=o,i&&(n=i.innerText),t=e.innerText;else if(r)e=r,c&&(n=c.innerText),t=e.innerText;else{if(!a)return null;e=a,t=e.innerText}return{container:e,subject:n,body:t}}();if(!n)return;const{container:t,subject:o,body:i}=n;if(t.classList.contains("clarity-checked")||t.classList.contains("clarity-scanning"))return;t.classList.add("clarity-scanning"),function(){if(document.getElementById("cl-badge"))return;const e=document.createElement("div");e.id="cl-badge",e.innerText="üõ°Ô∏è AI Scanning...",e.style.cssText="position:fixed; bottom:20px; right:20px; background:#f1c40f; color:#333; padding:8px 12px; border-radius:20px; font-weight:bold; z-index:9999; font-family:sans-serif; font-size:12px; box-shadow:0 2px 5px rgba(0,0,0,0.2);",document.body.appendChild(e)}(),console.log(`üëÅÔ∏è X-RAY SCAN: ${o}`);const r=`Subject: ${o}\n\n${i}`,c=Array.from(t.querySelectorAll("a")).map(e=>e.href);chrome.runtime.sendMessage({action:"analyze_context",text:r,links:c},n=>{t.classList.remove("clarity-scanning"),t.classList.add("clarity-checked"),document.getElementById("cl-badge")?.remove(),n&&n.isThreat&&(console.log("üö® THREAT DETECTED: Executing X-Ray Highlights..."),t.querySelectorAll("a, button, input").forEach(e=>{e.style.filter="blur(5px)",e.style.pointerEvents="none"}),function(e,n,t){if(document.getElementById("cl-alert"))return;const o=document.createElement("div");o.id="cl-alert",o.style.cssText="\n    position: fixed; top: 100px; right: 20px; width: 320px;\n    background: white; padding: 20px; border-radius: 8px;\n    box-shadow: 0 10px 40px rgba(0,0,0,0.4); border-left: 6px solid #c0392b;\n    z-index: 2147483647; font-family: sans-serif; animation: slideIn 0.3s;\n  ",o.innerHTML=`\n    <h3 style="margin:0 0 10px 0; color:#c0392b; font-size:16px;">‚ö†Ô∏è Threat Detected</h3>\n    <div style="background:#fff3cd; color:#856404; padding:10px; border-radius:4px; margin-bottom:12px; font-size:13px; line-height:1.4;">\n      <strong>Why:</strong> ${t}\n      <br><br>\n      <em style="color:#555">We highlighted suspicious terms in the email for you.</em>\n    </div>\n    <div style="font-size:12px; margin-bottom:15px; color:#555;">\n      <strong>Risk Score:</strong> ${n}/10\n    </div>\n    <button id="unl-btn" disabled style="width:100%; padding:10px; background:#ccc; border:none; border-radius:4px; color:white; font-weight:bold; cursor:not-allowed;">Wait 5s...</button>\n  `,document.body.appendChild(o);let i=5;const r=setInterval(()=>{i--;const n=document.getElementById("unl-btn");n&&(n.innerText=`Wait ${i}s...`),i<=0&&(clearInterval(r),n&&(n.disabled=!1,n.innerText="Unlock Links",n.style.background="#2c3e50",n.style.cursor="pointer",n.onclick=()=>{e.querySelectorAll("*").forEach(e=>{e.style.filter="",e.style.pointerEvents=""}),o.remove()}))},1e3)}(t,n.score,n.verdict),function(n){const t=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,null,!1);let o;const i=[];for(;o=t.nextNode();){const n=o.nodeValue;"SCRIPT"!==o.parentElement.tagName&&"STYLE"!==o.parentElement.tagName&&(e.some(e=>e.test(n))&&i.push(o))}i.forEach(n=>{const t=document.createElement("span");t.innerHTML=n.nodeValue,e.forEach(e=>{t.innerHTML=t.innerHTML.replace(e,e=>`<span style="background-color: #fadbd8; border-bottom: 2px solid #c0392b; color: #c0392b; font-weight: bold; padding: 0 2px; border-radius: 2px;">${e}</span>`)}),n.parentNode&&n.parentNode.replaceChild(t,n)})}(t))})},1500)})();