(()=>{console.log("üöÄ Clarity X-Ray: EMAIL MODE ACTIVE (Sender Scanning Enabled)");const e=[/verify your account/gi,/verify your identity/gi,/update your payment/gi,/log in/gi,/login/gi,/sign in/gi,/bank account/gi,/wire transfer/gi,/suspended/gi,/deactivated/gi,/urgent/gi,/immediate action/gi,/click here/gi,/password/gi,/credential/gi,/security alert/gi],n=new Set;setInterval(function(){const t=function(){const e=document.querySelector(".a3s.aiL")||document.querySelector(".a3s"),n=document.querySelector("h2.hP"),t=document.querySelector(".gD"),o=document.querySelector('[aria-label="Message body"]'),r=document.querySelector(".conv-title"),i=document.querySelector(".O3L68")||document.querySelector(".Un15K"),c=document.querySelector(".message-body, article");let l="Unknown Sender",a="No Subject",d="",s=null;if(e)s=e,n&&(a=n.innerText),t&&(l=`${t.innerText} <${t.getAttribute("email")||"hidden"}>`),d=e.innerText;else if(o)s=o,r&&(a=r.innerText),i&&(l=i.innerText),d=o.innerText;else{if(!c)return null;s=c,d=c.innerText}return{container:s,sender:l,subject:a,body:d}}();if(!t)return;const{container:o,sender:r,subject:i,body:c}=t,l=`${i}_${c.length}`;if(o.classList.contains("clarity-checked")||o.classList.contains("clarity-scanning"))return;if(n.has(l))return void(o.style.filter="none");o.classList.add("clarity-scanning"),function(){if(document.getElementById("cl-badge"))return;const e=document.createElement("div");e.id="cl-badge",e.innerText="üõ°Ô∏è AI Scanning...",e.style.cssText="position:fixed; bottom:20px; right:20px; background:#f1c40f; color:#333; padding:8px 12px; border-radius:20px; font-weight:bold; z-index:9999; font-family:sans-serif; font-size:12px; box-shadow:0 2px 5px rgba(0,0,0,0.2);",document.body.appendChild(e)}(),console.log(`üëÅÔ∏è Scanning: ${i} (From: ${r})`);const a=`From: ${r}\nSubject: ${i}\n\n${c}`,d=Array.from(o.querySelectorAll("a")).map(e=>e.href);chrome.runtime.sendMessage({action:"analyze_context",text:a,links:d},t=>{o.classList.remove("clarity-scanning"),o.classList.add("clarity-checked"),document.getElementById("cl-badge")?.remove(),t&&t.isThreat&&(console.log(`üö® THREAT DETECTED: ${t.verdict}`),o.querySelectorAll("a, button, input").forEach(e=>{e.style.filter="blur(5px)",e.style.pointerEvents="none"}),function(e,t,o,r){if(document.getElementById("cl-alert"))return;const i=document.createElement("div");i.id="cl-alert",i.style.cssText="\n    position: fixed; top: 100px; right: 20px; width: 320px;\n    background: white; padding: 20px; border-radius: 8px;\n    box-shadow: 0 10px 40px rgba(0,0,0,0.4); border-left: 6px solid #c0392b;\n    z-index: 2147483647; font-family: sans-serif; animation: slideIn 0.3s;\n  ",i.innerHTML=`\n    <h3 style="margin:0 0 10px 0; color:#c0392b;">‚ö†Ô∏è Threat Detected</h3>\n    <p style="font-size:13px; color:#555;">${o}</p>\n    <div style="font-size:12px; margin-bottom:10px; color:#777;">Risk Score: ${t}/10</div>\n    <button id="unl-btn" disabled style="width:100%; padding:10px; background:#ccc; border:none; border-radius:4px; color:white; font-weight:bold;">Wait 5s...</button>\n  `,document.body.appendChild(i);let c=5;const l=setInterval(()=>{c--;const t=document.getElementById("unl-btn");t&&(t.innerText=`Wait ${c}s...`),c<=0&&(clearInterval(l),t&&(t.disabled=!1,t.innerText="Unlock Links",t.style.background="#2c3e50",t.style.cursor="pointer",t.onclick=()=>{e.querySelectorAll("*").forEach(e=>{e.style.filter="",e.style.pointerEvents=""}),i.remove(),n.add(r)}))},1e3)}(o,t.score,t.verdict,l),function(n){const t=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,null,!1);let o;const r=[];for(;o=t.nextNode();){const n=o.nodeValue;"SCRIPT"!==o.parentElement.tagName&&"STYLE"!==o.parentElement.tagName&&e.some(e=>e.test(n))&&r.push(o)}r.forEach(n=>{const t=document.createElement("span");t.innerHTML=n.nodeValue,e.forEach(e=>{t.innerHTML=t.innerHTML.replace(e,e=>`<span style="background-color: #fadbd8; border-bottom: 2px solid #c0392b; color: #c0392b; font-weight: bold;">${e}</span>`)}),n.parentNode&&n.parentNode.replaceChild(t,n)})}(o))})},1500)})();